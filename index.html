<!DOCTYPE html>
<script src="questions.js"></script>
<script>
  const categories = {
    speed: 'Speed Limits',
    laws: 'Driving Laws',
    signs: 'Road Signs',
    distance: 'Following & Stopping Distance',
    parking: 'Parking Rules',
    pedestrians: 'Pedestrian Safety',
    signals: 'Turn Signals & Right of Way',
    night: 'Night Driving',
    emergencies: 'Emergency Situations'
  };

  let currentCategory = Object.keys(categories)[0];
  let shuffledQuestions = {};  // to hold shuffled copies by category

  // Shuffle options and update answer index for one question
  function shuffleQuestionOptions(question) {
    const options = [...question.options];
    const correctAnswer = question.options[question.answer];
    for (let i = options.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [options[i], options[j]] = [options[j], options[i]];
    }
    const newAnswerIndex = options.indexOf(correctAnswer);
    return { ...question, options, answer: newAnswerIndex };
  }

  // Prepare all categories with shuffled questions (deep copy + shuffle)
  function prepareShuffledQuestions() {
    Object.keys(categories).forEach(cat => {
      if (questions[cat]) {
        shuffledQuestions[cat] = questions[cat].map(q => shuffleQuestionOptions(q));
      } else {
        shuffledQuestions[cat] = [];
      }
    });
  }

  function loadCategoryTabs() {
    const tabs = document.getElementById('categoryTabs');
    tabs.innerHTML = '';
    Object.entries(categories).forEach(([key, label]) => {
      const btn = document.createElement('button');
      btn.textContent = label;
      btn.className = key === currentCategory ? 'active' : '';
      btn.onclick = () => {
        currentCategory = key;
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        loadQuestions();
      };
      tabs.appendChild(btn);
    });
  }

  function loadQuestions() {
    const container = document.getElementById('quizContainer');
    container.innerHTML = '';
    const qs = shuffledQuestions[currentCategory] || [];
    qs.forEach((q, i) => {
      const div = document.createElement('div');
      div.className = 'question';
      div.id = `q-${i}`;
      div.innerHTML = `<p><strong>Q${i + 1}:</strong> ${q.question}</p>
        ${q.image ? `<img src="${q.image}" alt="Question Image">` : ''}
        ${q.options.map((opt, j) => `
          <div><label><input type="radio" name="q${i}" value="${j}"> ${opt}</label></div>
        `).join('')}`;
      container.appendChild(div);
    });
  }

  function submitQuiz() {
    const qs = shuffledQuestions[currentCategory] || [];
    qs.forEach((q, i) => {
      const radios = document.getElementsByName(`q${i}`);
      const selected = [...radios].find(r => r.checked);
      const div = document.getElementById(`q-${i}`);
      div.classList.remove('correct', 'incorrect'); // clear old classes

      if (selected && parseInt(selected.value) === q.answer) {
        div.classList.add('correct');
      } else {
        div.classList.add('incorrect');
      }

      if (!div.querySelector('.explanation')) {
        const exp = document.createElement('div');
        exp.className = 'explanation';
        exp.textContent = `Explanation: ${q.explanation}`;
        div.appendChild(exp);
      }
    });
  }

  // Initialize
  prepareShuffledQuestions();
  loadCategoryTabs();
  loadQuestions();

  // Expose submitQuiz globally if needed
  window.submitQuiz = submitQuiz;
</script>
